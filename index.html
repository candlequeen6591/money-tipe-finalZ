<script>
    // --- 音声生成システム (Web Audio API) ---
    let audioCtx;

    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }

    function playTone(freq, type, duration, delay = 0) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime + delay);
        
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime + delay);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + delay + duration);

        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(audioCtx.currentTime + delay);
        osc.stop(audioCtx.currentTime + delay + duration);
    }

    function playCoinSound() {
        initAudio();
        playTone(987, 'sine', 0.1); 
        playTone(1318, 'sine', 0.4, 0.05);
    }

    function playClickSound() {
        initAudio();
        playTone(800, 'triangle', 0.1); 
    }

    function playFanfare() {
        initAudio();
        playTone(523.25, 'triangle', 0.3, 0);    
        playTone(659.25, 'triangle', 0.3, 0.15); 
        playTone(783.99, 'triangle', 0.3, 0.30); 
        playTone(1046.50, 'triangle', 0.8, 0.45);
    }

    // --- 診断ロジック ---

    // ★★★ 修正箇所：startGame関数の処理順序を変更しました ★★★
    function startGame() {
        // 1. Audio Contextを有効化（クリック操作で音を鳴らす準備）
        initAudio(); 
        
        // 2. 画面の切り替えを最優先で実行（エラーに関わらず表示を保証）
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-area').style.display = 'block';

        // 3. 音を鳴らし、質問を開始
        playCoinSound(); 
        showQuestion();
    }

    const questions = [
        { text: "Q1. お年玉（まとまったお金）をもらった！まずどうする？", options: [{ text: "すぐに貯金箱に入れる", type: "A" }, { text: "欲しかったものをすぐに買う！", type: "B" }, { text: "いくら使うか計画を立てる", type: "C" }, { text: "家族や友達にプレゼントを買う", type: "D" }, { text: "どうやって増やそうか考える", type: "E" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q2. 100円をなくした！どうしよう…？", options: [{ text: "ショックで立ち直れない…", type: "G" }, { text: "また稼げばいいから気にしない", type: "E" }, { text: "「次は気をつけよう」と反省する", type: "C" }, { text: "なくなっても後悔しないようにすぐ使うべきだった", type: "B" }, { text: "お金は使ってこそ意味がある", type: "H" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q3. 友達の誕生日プレゼント選び。どうする？", options: [{ text: "予算を決め、それに合わせて考える", type: "C" }, { text: "相手が本当に喜ぶものを値段気にせず選ぶ", type: "D" }, { text: "手作りにするか、お金をかけない方法を考える", type: "A" }, { text: "一緒に遊園地などに行き、思い出をプレゼント", type: "H" }, { text: "その時の気分でピンときたものを買う", type: "F" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q4. 欲しいものがあるけどお金が足りない…どうする？", options: [{ text: "すぐ親にお願いする、または借りる", type: "F" }, { text: "お手伝いを増やしたり、不用品を売って稼ぐ", type: "E" }, { text: "目標額を決め、計画的に貯める", type: "C" }, { text: "損をしたくないから、とりあえず我慢する", type: "G" }, { text: "友達と協力して手に入れる方法を考える", type: "D" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q5. 買い物に行った時、セール品を見つけたら？", options: [{ text: "得だから、とりあえず買っておく！", type: "B" }, { text: "計画にないから、触らないようにする", type: "A" }, { text: "「安いから」だけで買って失敗しないか不安", type: "G" }, { text: "本当に必要か、一旦家に帰って考える", type: "C" }, { text: "その時の気分で欲しいと思ったら買う", type: "F" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q6. お小遣い帳（記録）をつけるのは好き？", options: [{ text: "きっちり記録するのが楽しい", type: "C" }, { text: "面倒くさい、記録はしない", type: "F" }, { text: "お金が増減する記録を見るのは楽しい", type: "E" }, { text: "記録をしないと、不安で仕方ない", type: "G" }, { text: "誰と何に使ったか（思い出）を記録するのは好き", type: "D" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q7. お金を使って一番嬉しいのはどんな時？", options: [{ text: "自分の貯金が増えていくのを見た時", type: "A" }, { text: "欲しかったモノをゲットした瞬間", type: "B" }, { text: "新しいことを学んだり、面白い場所に行った時", type: "H" }, { text: "誰かに喜んでもらえた時", type: "D" }, { text: "自分が頑張った対価として稼げた時", type: "E" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q8. 1ヶ月間、お金を全然使わなかった！感想は？", options: [{ text: "目標達成！最高の気分だ", type: "A" }, { text: "使うのを忘れていた。特になんとも思わない", type: "F" }, { text: "もったいないことをした。もっと使えばよかった", type: "B" }, { text: "このままお金が減らないでほしいと強く思う", type: "G" }, { text: "誰かの役に立つことに使いたかった", type: "D" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q9. 貯金箱のお金が、友達のお菓子代に足りないと言われたら？", options: [{ text: "快く貸してあげる（またはプレゼントする）", type: "D" }, { text: "貸せない。貯金は崩したくない", type: "A" }, { text: "貸せるけど、いつ返してくれるか約束してもらう", type: "C" }, { text: "一緒に稼ぐ方法を提案する", type: "E" }, { text: "貸すのは嫌だけど、断りづらい…", type: "G" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q10. 好きなブランドやお店を見つけたら？", options: [{ text: "他の店と比較して本当に安いか確かめる", type: "C" }, { text: "他にはない、珍しい体験ができるならお金を出す", type: "H" }, { text: "お店の裏側（どうやって儲けているか）に興味を持つ", type: "E" }, { text: "気に入ったら、他のものは見ずにそこで買う", type: "B" }, { text: "気に入ったけど、ここで買ったら損するんじゃないか迷う", type: "G" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q11. お金を使うことで得られるのは何だと思う？", options: [{ text: "安全や安心", type: "A" }, { text: "喜びや楽しみ", type: "B" }, { text: "知識や経験", type: "H" }, { text: "信頼や感謝", type: "D" }, { text: "自由", type: "F" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q12. お財布が壊れてしまった！どうする？", options: [{ text: "新しいお財布をすぐに買いに行く", type: "B" }, { text: "修理代と新しいものを比べるなど、一番得する方法を考える", type: "C" }, { text: "また壊れるのが嫌だから、お財布は使わずジップロック", type: "G" }, { text: "お小遣いを貯めて、高品質で長持ちするものを買う", type: "A" }, { text: "デザインが気に入ったものを直感で選ぶ", type: "F" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q13. 【もし】100万円が当たったら、まずどうする？", options: [{ text: "半分以上は貯金する", type: "A" }, { text: "旅行や特別な体験など、一生の思い出に使う", type: "H" }, { text: "投資やビジネスのアイデアに使って増やす", type: "E" }, { text: "家族や親戚、困っている人に分ける", type: "D" }, { text: "全て銀行に預け、怖くて使えない", type: "G" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q14. お金が少し足りない時、借りることについてどう思う？", options: [{ text: "恥ずかしい。誰にも借りたくない", type: "G" }, { text: "借りる前に、どうやったら稼げるか考える", type: "E" }, { text: "返す計画をしっかり立てられるなら問題ない", type: "C" }, { text: "借りてでも今すぐ欲しいものがあるなら借りる", type: "B" }, { text: "友達が困っているなら、自分はすぐに貸してあげる", type: "D" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q15. 中古品（used）を買うのは好き？", options: [{ text: "新品でなければ嫌だ。安心感が大切", type: "G" }, { text: "中古でも、体験できる価値が変わらないなら買う", type: "H" }, { text: "新品より安いなら、得だから喜んで買う", type: "A" }, { text: "品質より、デザインやメーカーにこだわって買う", type: "B" }, { text: "中古を安く買って、きれいに直して売る方が楽しい", type: "E" }, { text: "どれもあまり当てはまらない", type: "N" }] },
        { text: "Q16. 大切な情報の管理についてどう思う？", options: [{ text: "厳重に守る。誰にも見られないように隠す", type: "G" }, { text: "必要な時だけ使う。記録はノートにしっかりつけておく", type: "C" }, { text: "どうでもいい。失くしたらまた作ればいい", type: "F" }, { text: "良い情報はみんなで共有すべきだ", type: "D" }, { text: "他の人の情報も分析して、ビジネスに活かせないか考える", type: "E" }, { text: "どれもあまり当てはまらない", type: "N" }] }
    ];

    const results = {
        "A": { animal: "🐿️", title: "コツコツ貯める「リスさん」", catch: "～目標達成型の堅実貯蓄家～", desc: "キミは将来の目標のために我慢できる、意志の強い堅実家！計画的で、貯金が増えるのを見るのが大好きです。<br><strong>💰アドバイス：</strong>貯めたお金は、計画的に使うことで、さらに大きな喜びにつながりますよ！" },
        "B": { animal: "🐰", title: "パッと使う「ウサギさん」", catch: "～「欲しい」に一直線の衝動消費家～", desc: "キミは行動力バツグンの元気っ子！楽しいことや欲しいもののためにお金を使うのが得意です。<br><strong>💰アドバイス：：</strong>大きな買い物をする前には「一晩考える」ルールを作ると、さらに満足度の高い使い方ができます！" },
        "C": { animal: "🦉", title: "しっかり計画「フクロウ博士」", catch: "～冷静沈着な予算戦略家～", desc: "キミは頭を使って上手にお金と付き合える博士タイプ。予算管理や、損をしないための比較検討が得意です。<br><strong>💰アドバイス：</strong>完璧を目指して考えすぎちゃうことも。「これが好き！」という自分の直感も大切にしてみてね。" },
        "D": { animal: "🧸", title: "みんなハッピー「クマさん」", catch: "～優しさあふれる利他的消費家～", desc: "キミは誰かのためにお金を使うことに一番幸せを感じる、優しい心の持ち主です。<br><strong>💰アドバイス：</strong>人助けは素晴らしいですが、先に自分自身の「将来の貯金」という名の安全基地をしっかり作ってあげましょう。" },
        "E": { animal: "🦁", title: "稼ぐの大好き「ライオン社長」", catch: "～お金を増やす未来の起業家～", desc: "キミは「お金を使う」だけでなく、「稼ぐ」「増やす」という視点を持ったリーダータイプ！<br><strong>💰アドバイス：</strong>稼ぐことに夢中になりすぎず、「何のために稼ぐのか」という目的を明確にすると、人望も集まります。" },
        "F": { animal: "🐱", title: "気ままな「ネコさん」", catch: "～気分で動く自由な直感派～", desc: "キミは周りに流されず、その時の気分や直感で動く自由人。ルールに縛られるのが嫌いで、自分の価値観が第一です。<br><strong>💰アドバイス：</strong>直感は大事ですが、お財布の中身が空っぽになる前に、スマホなどでざっくりと残高を確認する習慣をつけると安心です！" },
        "G": { animal: "🦔", title: "超慎重な「ハリネズミ」", catch: "～お金の損失を極度に恐れる防衛派～", desc: "キミは損をすることや、お金が減ることを極度に恐れるタイプ。貯金を崩すのが嫌いで、常に備えています。<br><strong>💰アドバイス：：</strong>お金は「安心」のために貯めるものです。時にはその安心を元に、新しい経験のために使ってみると世界が広がりますよ。" },
        "H": { animal: "🐬", title: "体験投資家「イルカ」", catch: "～モノより学びと経験を求める探究者～", desc: "キミは洋服やおもちゃなどの「モノ」にはあまり興味がなく、「経験や知識」にお金を投資するのが好きです。<br><strong>💰アドバイス：</strong>体験は素晴らしい財産ですが、緊急時のお金も大切です。経験のための予算と、貯金のための予算を分けて作りましょう。" },
        "N": { animal: "🌈", title: "なんでもOK「にじいろ」タイプ", catch: "～可能性は無限大のマルチプレイヤー～", desc: "キミはどのタイプにも当てはまらない、自由でユニークな感性の持ち主です！その時の状況や気分で、どのタイプにもなれる、可能性が無限大なタイプだよ！<br><strong>💰アドバイス：：</strong>キミは全てを使いこなせる天才かも！一つに絞らず、いろんなお金の使い方にチャレンジしてみてね。" }
    };

    let currentQuestionIndex = 0;
    let scores = { A: 0, B: 0, C: 0, D: 0, E: 0, F: 0, G: 0, H: 0, N: 0 };
    const totalQuestions = questions.length;
    // --- 略 ---
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>
